"""
ì¬ë¬´ë°ì´í„° ë³‘í•© ë° ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°
===============================

ê¸°ëŠ¥:
1. ë‘ ê°œì˜ CSV íŒŒì¼ì„ ['ê±°ë˜ì†Œì½”ë“œ', 'íšŒê³„ë…„ë„'] ê¸°ì¤€ìœ¼ë¡œ ë³‘í•©
2. ì²« ë²ˆì§¸ CSVì˜ ê²°ì¸¡ì¹˜ë¥¼ ë‘ ë²ˆì§¸ CSV ë°ì´í„°ë¡œ ì±„ì›€
3. ì»¬ëŸ¼ëª… ë§¤ì¹­ (ì˜ˆ: ìì‚°(IFRSì—°ê²°)(ì²œì›) â†” ìì‚°(IFRS)(ì²œì›))
4. ë‘ ë²ˆì§¸ íŒŒì¼ì—ë§Œ ìˆëŠ” ì»¬ëŸ¼ ì¶”ê°€
5. íšŒê³„ë…„ë„ í•„í„°ë§ (12ì›”ë§Œ ìœ ì§€)
6. ê²°ê³¼ë¥¼ data/processed/FS_temp.csvë¡œ ì €ì¥

ì‚¬ìš©ë²•:
    python step6_merge_fill_financial_data.py
"""

import pandas as pd
import numpy as np
import os
from pathlib import Path
import logging
from datetime import datetime
import re

class FinancialDataMerger:
    """ì¬ë¬´ë°ì´í„° ë³‘í•© ë° ê²°ì¸¡ì¹˜ ì±„ìš°ê¸° í´ë˜ìŠ¤"""
    
    def __init__(self, primary_file: str, secondary_file: str):
        """
        ì´ˆê¸°í™”
        
        Args:
            primary_file: ì²« ë²ˆì§¸ CSV íŒŒì¼ ê²½ë¡œ (ë©”ì¸ ë°ì´í„°)
            secondary_file: ë‘ ë²ˆì§¸ CSV íŒŒì¼ ê²½ë¡œ (ë³´ì™„ ë°ì´í„°)
        """
        self.primary_file = primary_file
        self.secondary_file = secondary_file
        self.project_root = Path(__file__).parent.parent.parent
        
        # ë¡œê¹… ì„¤ì •
        self.logger = self._setup_logging()
        
        # ì»¬ëŸ¼ ë§¤ì¹­ ë”•ì…”ë„ˆë¦¬ (ì—°ê²°.csv â†’ ê°œë³„.csv ì „ì²´ ìˆ˜ë™ ë§¤í•‘)
        self.column_mapping = {
            # ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ë“¤ (ë™ì¼)
            'íšŒì‚¬ëª…': 'íšŒì‚¬ëª…',
            'ê±°ë˜ì†Œì½”ë“œ': 'ê±°ë˜ì†Œì½”ë“œ', 
            'íšŒê³„ë…„ë„': 'íšŒê³„ë…„ë„',
            
            # ê¸°ë³¸ ì¬ë¬´ì œí‘œ í•­ëª©ë“¤
            'ìì‚°(*)(IFRSì—°ê²°)(ì²œì›)': 'ìì‚°(*)(IFRS)(ì²œì›)',
            'ë¶€ì±„(*)(IFRSì—°ê²°)(ì²œì›)': 'ë¶€ì±„(*)(IFRS)(ì²œì›)',
            'ìë³¸(*)(IFRSì—°ê²°)(ì²œì›)': 'ìë³¸(*)(IFRS)(ì²œì›)',
            '* ë°œí–‰í•œ ì£¼ì‹ì´ìˆ˜(*)(IFRSì—°ê²°)(ì²œì›)': '* ë°œí–‰í•œ ì£¼ì‹ì´ìˆ˜(*)(IFRS)(ì£¼)',  # ë‹¨ìœ„ ë‹¤ë¦„
            'ìœ ë™ìì‚°(*)(IFRSì—°ê²°)(ì²œì›)': 'ìœ ë™ìì‚°(*)(IFRS)(ì²œì›)',
            'ìœ ë™ë¶€ì±„(*)(IFRSì—°ê²°)(ì²œì›)': 'ìœ ë™ë¶€ì±„(*)(IFRS)(ì²œì›)',
            'ë§¤ì¶œì•¡(ìˆ˜ìµ)(*)(IFRSì—°ê²°)(ì²œì›)': 'ë§¤ì¶œì•¡(ìˆ˜ìµ)(*)(IFRS)(ì²œì›)',
            'ìë³¸ê¸ˆ(*)(IFRSì—°ê²°)(ì²œì›)': 'ìë³¸ê¸ˆ(*)(IFRS)(ì²œì›)',
            'ì´ìµì‰ì—¬ê¸ˆ(ê²°ì†ê¸ˆ)(*)(IFRSì—°ê²°)(ì²œì›)': 'ì´ìµì‰ì—¬ê¸ˆ(ê²°ì†ê¸ˆ)(*)(IFRS)(ì²œì›)',
            '* (ì •ìƒ)ì˜ì—…ì†ìµ(ë³´ê³ ì„œê¸°ì¬)(IFRSì—°ê²°)(ì²œì›)': '* (ì •ìƒ)ì˜ì—…ì†ìµ(ë³´ê³ ì„œê¸°ì¬)(IFRS)(ì²œì›)',
            'ë‹¹ê¸°ìˆœì´ìµ(ì†ì‹¤)(IFRSì—°ê²°)(ì²œì›)': 'ë‹¹ê¸°ìˆœì´ìµ(ì†ì‹¤)(IFRS)(ì²œì›)',
            'ì˜ì—…í™œë™ìœ¼ë¡œ ì¸í•œ í˜„ê¸ˆíë¦„(ê°„ì ‘ë²•)(*)(IFRSì—°ê²°)(ì²œì›)': 'ì˜ì—…í™œë™ìœ¼ë¡œ ì¸í•œ í˜„ê¸ˆíë¦„(ê°„ì ‘ë²•)(*)(IFRS)(ì²œì›)',
            
            # ì¬ë¬´ë¹„ìœ¨ë“¤
            'ë§¤ì¶œì•¡ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ë§¤ì¶œì•¡ì¦ê°€ìœ¨(IFRS)',
            'ë§¤ì¶œì•¡ì´ì´ìµë¥ (IFRSì—°ê²°)': 'ë§¤ì¶œì•¡ì´ì´ìµë¥ (IFRS)',
            'ë§¤ì¶œì•¡ì •ìƒì˜ì—…ì´ìµë¥ (IFRSì—°ê²°)': 'ë§¤ì¶œì•¡ì •ìƒì˜ì—…ì´ìµë¥ (IFRS)',
            'ë§¤ì¶œì•¡ìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ë§¤ì¶œì•¡ìˆœì´ìµë¥ (IFRS)',
            'ì´ìë³¸ìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ì´ìë³¸ìˆœì´ìµë¥ (IFRS)',
            'ìê¸°ìë³¸ìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ìê¸°ìë³¸ìˆœì´ìµë¥ (IFRS)',
            'ìœ ë™ë¹„ìœ¨(IFRSì—°ê²°)': 'ìœ ë™ë¹„ìœ¨(IFRS)',
            'ë¶€ì±„ë¹„ìœ¨(IFRSì—°ê²°)': 'ë¶€ì±„ë¹„ìœ¨(IFRS)',
            'ì´ìë³´ìƒë°°ìœ¨(ì´ìë¹„ìš©)(IFRSì—°ê²°)': 'ì´ìë³´ìƒë°°ìœ¨(ì´ìë¹„ìš©)(IFRS)',
            'ì´ìë³¸íšŒì „ë¥ (IFRSì—°ê²°)': 'ì´ìë³¸íšŒì „ë¥ (IFRS)',
            
            # ì¦ê°€ìœ¨ ì§€í‘œë“¤
            'ì´ìë³¸ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì´ìë³¸ì¦ê°€ìœ¨(IFRS)',
            'ìœ í˜•ìì‚°ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ìœ í˜•ìì‚°ì¦ê°€ìœ¨(IFRS)',
            'ë¹„ìœ ë™ìƒë¬¼ìì‚°ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ë¹„ìœ ë™ìƒë¬¼ìì‚°ì¦ê°€ìœ¨(IFRS)',
            'íˆ¬ìë¶€ë™ì‚°ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'íˆ¬ìë¶€ë™ì‚°ì¦ê°€ìœ¨(IFRS)',
            'ë¹„ìœ ë™ìì‚°ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ë¹„ìœ ë™ìì‚°ì¦ê°€ìœ¨(IFRS)',
            'ìœ ë™ìì‚°ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ìœ ë™ìì‚°ì¦ê°€ìœ¨(IFRS)',
            'ì¬ê³ ìì‚°ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì¬ê³ ìì‚°ì¦ê°€ìœ¨(IFRS)',
            'ìê¸°ìë³¸ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ìê¸°ìë³¸ì¦ê°€ìœ¨(IFRS)',
            'ì •ìƒì˜ì—…ì´ìµì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì •ìƒì˜ì—…ì´ìµì¦ê°€ìœ¨(IFRS)',
            'ìˆœì´ìµì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ìˆœì´ìµì¦ê°€ìœ¨(IFRS)',
            'ì´í¬ê´„ì´ìµì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì´í¬ê´„ì´ìµì¦ê°€ìœ¨(IFRS)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ë¶€ê°€ê°€ì¹˜ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì¢…ì—…ì›1ì¸ë‹¹ ë¶€ê°€ê°€ì¹˜ì¦ê°€ìœ¨(IFRS)',
            'ì¢…ì—…ì›ìˆ˜ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì¢…ì—…ì›ìˆ˜ì¦ê°€ìœ¨(IFRS)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ë§¤ì¶œì•¡ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì¢…ì—…ì›1ì¸ë‹¹ ë§¤ì¶œì•¡ì¦ê°€ìœ¨(IFRS)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ì¸ê±´ë¹„ì¦ê°€ìœ¨(IFRSì—°ê²°)': 'ì¢…ì—…ì›1ì¸ë‹¹ ì¸ê±´ë¹„ì¦ê°€ìœ¨(IFRS)',
            
            # ìˆ˜ìµì„± ì§€í‘œë“¤
            'ì´ìë³¸ì‚¬ì—…ì´ìµë¥ (IFRSì—°ê²°)': 'ì´ìë³¸ì‚¬ì—…ì´ìµë¥ (IFRS)',
            'ì´ìë³¸ì •ìƒì˜ì—…ì´ìµë¥ (IFRSì—°ê²°)': 'ì´ìë³¸ì •ìƒì˜ì—…ì´ìµë¥ (IFRS)',
            'ìê¸°ìë³¸ì •ìƒì˜ì—…ì´ìµë¥ (IFRSì—°ê²°)': 'ìê¸°ìë³¸ì •ìƒì˜ì—…ì´ìµë¥ (IFRS)',
            'ê²½ì˜ìë³¸ì •ìƒì˜ì—…ì´ìµë¥ (IFRSì—°ê²°)': 'ê²½ì˜ìë³¸ì •ìƒì˜ì—…ì´ìµë¥ (IFRS)',
            'ê²½ì˜ìë³¸ìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ê²½ì˜ìë³¸ìˆœì´ìµë¥ (IFRS)',
            'ìë³¸ê¸ˆì •ìƒì˜ì—…ì´ìµë¥ (IFRSì—°ê²°)': 'ìë³¸ê¸ˆì •ìƒì˜ì—…ì´ìµë¥ (IFRS)',
            'ìë³¸ê¸ˆìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ìë³¸ê¸ˆìˆœì´ìµë¥ (IFRS)',
            
            # ë¹„ìš©êµ¬ì¡° ì§€í‘œë“¤
            'ë§¤ì¶œì›ê°€ ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRSì—°ê²°)': 'ë§¤ì¶œì›ê°€ ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRS)',
            'ì˜ì—…ë¹„ìš© ëŒ€ ì˜ì—…ìˆ˜ìµë¹„ìœ¨(IFRSì—°ê²°)': 'ì˜ì—…ë¹„ìš© ëŒ€ ì˜ì—…ìˆ˜ìµë¹„ìœ¨(IFRS)',
            'ê¸°íƒ€ì†ìµë¹„ë¥ (IFRSì—°ê²°)': 'ê¸°íƒ€ì†ìµë¹„ë¥ (IFRS)',
            'ê¸ˆìœµì†ìµë¹„ìœ¨(IFRSì—°ê²°)': 'ê¸ˆìœµì†ìµë¹„ìœ¨(IFRS)',
            'ê¸ˆìœµë¹„ìš©ë¶€ë‹´ë¥ (IFRSì—°ê²°)': 'ê¸ˆìœµë¹„ìš©ë¶€ë‹´ë¥ (IFRS)',
            'ì™¸í™˜ì´ìµ ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRSì—°ê²°)': 'ì™¸í™˜ì´ìµ ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRS)',
            'ê´‘ê³ ì„ ì „ë¹„ ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRSì—°ê²°)': 'ê´‘ê³ ì„ ì „ë¹„ ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRS)',
            'ì„¸ê¸ˆê³¼ê³µê³¼ ëŒ€ ì„¸ê¸ˆê³¼ê³µê³¼ ì°¨ê°ì „ìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ì„¸ê¸ˆê³¼ê³µê³¼ ëŒ€ ì„¸ê¸ˆê³¼ê³µê³¼ ì°¨ê°ì „ìˆœì´ìµë¥ (IFRS)',
            'ê¸°ì—…ìˆœì´ìµë¥ (IFRSì—°ê²°)': 'ê¸°ì—…ìˆœì´ìµë¥ (IFRS)',
            'ìˆ˜ì§€ë¹„ìœ¨(ê´€ê³„ê¸°ì—…íˆ¬ìì†ìµ ì œì™¸)(IFRSì—°ê²°)': 'ìˆ˜ì§€ë¹„ìœ¨(ê´€ê³„ê¸°ì—…íˆ¬ìì†ìµ ì œì™¸)(IFRS)',
            'ì¸ê±´ë¹„ ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRSì—°ê²°)': 'ì¸ê±´ë¹„ ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRS)',
            'R & D íˆ¬ìíš¨ìœ¨(IFRSì—°ê²°)': 'R & D íˆ¬ìíš¨ìœ¨(IFRS)',
            'ì„¸ê¸ˆê³¼ê³µê³¼ ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRSì—°ê²°)': 'ì„¸ê¸ˆê³¼ê³µê³¼ ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRS)',
            'ê¸ˆìœµë¹„ìš© ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRSì—°ê²°)': 'ê¸ˆìœµë¹„ìš© ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRS)',
            'ê°ê°€ìƒê°ë¹„ ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRSì—°ê²°)': 'ê°ê°€ìƒê°ë¹„ ëŒ€ ì´ë¹„ìš©ë¹„ìœ¨(IFRS)',
            
            # ê¸°ë³¸ ì§€í‘œë“¤
            'ê°ê°€ìƒê°ë¥ (IFRSì—°ê²°)': 'ê°ê°€ìƒê°ë¥ (IFRS)',
            'ëˆ„ì ê°ê°€ìƒê°ë¥ (IFRSì—°ê²°)': 'ëˆ„ì ê°ê°€ìƒê°ë¥ (IFRS)',
            'ì´ìë¶€ë‹´ë¥ (IFRSì—°ê²°)': 'ì´ìë¶€ë‹´ë¥ (IFRS)',
            'ì§€ê¸‰ì´ììœ¨(IFRSì—°ê²°)': 'ì§€ê¸‰ì´ììœ¨(IFRS)',
            'ì°¨ì…ê¸ˆí‰ê· ì´ììœ¨(IFRSì—°ê²°)': 'ì°¨ì…ê¸ˆí‰ê· ì´ììœ¨(IFRS)',
            'ìœ ë³´ìœ¨(IFRSì—°ê²°)': 'ìœ ë³´ìœ¨(IFRS)',
            'ì‚¬ë‚´ìœ ë³´ìœ¨(IFRSì—°ê²°)': 'ì‚¬ë‚´ìœ ë³´ìœ¨(IFRS)',
            'ì‚¬ë‚´ìœ ë³´ ëŒ€ ìê¸°ìë³¸ë¹„ìœ¨(IFRSì—°ê²°)': 'ì‚¬ë‚´ìœ ë³´ ëŒ€ ìê¸°ìë³¸ë¹„ìœ¨(IFRS)',
            'ì ë¦½ê¸ˆë¹„ìœ¨(ì¬ì •ë¹„ìœ¨)(IFRSì—°ê²°)': 'ì ë¦½ê¸ˆë¹„ìœ¨(ì¬ì •ë¹„ìœ¨)(IFRS)',
            'í‰ê· ë°°ë‹¹ë¥ (IFRSì—°ê²°)': 'í‰ê· ë°°ë‹¹ë¥ (IFRS)',
            'ìê¸°ìë³¸ë°°ë‹¹ë¥ (IFRSì—°ê²°)': 'ìê¸°ìë³¸ë°°ë‹¹ë¥ (IFRS)',
            'ë°°ë‹¹ì„±í–¥(IFRSì—°ê²°)': 'ë°°ë‹¹ì„±í–¥(IFRS)',
            
            # ì£¼ë‹¹ ì§€í‘œë“¤
            '1ì£¼ë‹¹ë§¤ì¶œì•¡(IFRSì—°ê²°)(ì›)': '1ì£¼ë‹¹ë§¤ì¶œì•¡(IFRS)(ì›)',
            '1ì£¼ë‹¹ìˆœì´ìµ(IFRSì—°ê²°)(ì›)': '1ì£¼ë‹¹ìˆœì´ìµ(IFRS)(ì›)',
            '1ì£¼ë‹¹ CASH FLOW(IFRSì—°ê²°)(ì›)': '1ì£¼ë‹¹ CASH FLOW(IFRS)(ì›)',
            '1ì£¼ë‹¹ìˆœìì‚°(IFRSì—°ê²°)(ì›)': '1ì£¼ë‹¹ìˆœìì‚°(IFRS)(ì›)',
            '1ì£¼ë‹¹ì •ìƒì˜ì—…ì´ìµ(IFRSì—°ê²°)(ì›)': '1ì£¼ë‹¹ì •ìƒì˜ì—…ì´ìµ(IFRS)(ì›)',
            
            # êµ¬ì„±ë¹„ìœ¨ ë° ì•ˆì •ì„± ì§€í‘œë“¤
            'ìœ ë™ìì‚°êµ¬ì„±ë¹„ìœ¨(IFRSì—°ê²°)': 'ìœ ë™ìì‚°êµ¬ì„±ë¹„ìœ¨(IFRS)',
            'ì¬ê³ ìì‚° ëŒ€ ìœ ë™ìì‚°ë¹„ìœ¨(IFRSì—°ê²°)': 'ì¬ê³ ìì‚° ëŒ€ ìœ ë™ìì‚°ë¹„ìœ¨(IFRS)',
            'ìœ ë™ìì‚° ëŒ€ ë¹„ìœ ë™ìì‚°ë¹„ìœ¨(IFRSì—°ê²°)': 'ìœ ë™ìì‚° ëŒ€ ë¹„ìœ ë™ìì‚°ë¹„ìœ¨(IFRS)',
            'ë‹¹ì¢Œìì‚°êµ¬ì„±ë¹„ìœ¨(IFRSì—°ê²°)': 'ë‹¹ì¢Œìì‚°êµ¬ì„±ë¹„ìœ¨(IFRS)',
            'ë¹„ìœ ë™ìì‚°êµ¬ì„±ë¹„ìœ¨(IFRSì—°ê²°)': 'ë¹„ìœ ë™ìì‚°êµ¬ì„±ë¹„ìœ¨(IFRS)',
            'ìê¸°ìë³¸êµ¬ì„±ë¹„ìœ¨(IFRSì—°ê²°)': 'ìê¸°ìë³¸êµ¬ì„±ë¹„ìœ¨(IFRS)',
            'íƒ€ì¸ìë³¸êµ¬ì„±ë¹„ìœ¨(IFRSì—°ê²°)': 'íƒ€ì¸ìë³¸êµ¬ì„±ë¹„ìœ¨(IFRS)',
            'ìê¸°ìë³¸ë°°ìœ¨(IFRSì—°ê²°)': 'ìê¸°ìë³¸ë°°ìœ¨(IFRS)',
            'ë¹„ìœ ë™ë¹„ìœ¨(IFRSì—°ê²°)': 'ë¹„ìœ ë™ë¹„ìœ¨(IFRS)',
            'ë¹„ìœ ë™ì¥ê¸°ì í•©ë¥ (IFRSì—°ê²°)': 'ë¹„ìœ ë™ì¥ê¸°ì í•©ë¥ (IFRS)',
            'ë‹¹ì¢Œë¹„ìœ¨(IFRSì—°ê²°)': 'ë‹¹ì¢Œë¹„ìœ¨(IFRS)',
            'í˜„ê¸ˆë¹„ìœ¨(IFRSì—°ê²°)': 'í˜„ê¸ˆë¹„ìœ¨(IFRS)',
            'ë§¤ì¶œì±„ê¶Œë¹„ìœ¨(IFRSì—°ê²°)': 'ë§¤ì¶œì±„ê¶Œë¹„ìœ¨(IFRS)',
            'ì¬ê³ ìì‚° ëŒ€ ìˆœìš´ì „ìë³¸ë¹„ìœ¨(IFRSì—°ê²°)': 'ì¬ê³ ìì‚° ëŒ€ ìˆœìš´ì „ìë³¸ë¹„ìœ¨(IFRS)',
            'ë§¤ì¶œì±„ê¶Œ ëŒ€ ë§¤ì…ì±„ë¬´ë¹„ìœ¨(IFRSì—°ê²°)': 'ë§¤ì¶œì±„ê¶Œ ëŒ€ ë§¤ì…ì±„ë¬´ë¹„ìœ¨(IFRS)',
            'ë§¤ì¶œì±„ê¶Œ ëŒ€ ìƒ,ì œí’ˆë¹„ìœ¨(IFRSì—°ê²°)': 'ë§¤ì¶œì±„ê¶Œ ëŒ€ ìƒ,ì œí’ˆë¹„ìœ¨(IFRS)',
            'ë§¤ì…ì±„ë¬´ ëŒ€ ì¬ê³ ìì‚°ë¹„ìœ¨(IFRSì—°ê²°)': 'ë§¤ì…ì±„ë¬´ ëŒ€ ì¬ê³ ìì‚°ë¹„ìœ¨(IFRS)',
            'ìœ ë™ë¶€ì±„ë¹„ìœ¨(IFRSì—°ê²°)': 'ìœ ë™ë¶€ì±„ë¹„ìœ¨(IFRS)',
            'ë‹¨ê¸°ì°¨ì…ê¸ˆ ëŒ€ ì´ì°¨ì…ê¸ˆë¹„ìœ¨(IFRSì—°ê²°)': 'ë‹¨ê¸°ì°¨ì…ê¸ˆ ëŒ€ ì´ì°¨ì…ê¸ˆë¹„ìœ¨(IFRS)',
            'ë¹„ìœ ë™ë¶€ì±„ë¹„ìœ¨(IFRSì—°ê²°)': 'ë¹„ìœ ë™ë¶€ì±„ë¹„ìœ¨(IFRS)',
            'ë¹„ìœ ë™ë¶€ì±„ ëŒ€ ìˆœìš´ì „ìë³¸ë¹„ìœ¨(IFRSì—°ê²°)': 'ë¹„ìœ ë™ë¶€ì±„ ëŒ€ ìˆœìš´ì „ìë³¸ë¹„ìœ¨(IFRS)',
            'ìˆœìš´ì „ìë³¸ë¹„ìœ¨(IFRSì—°ê²°)': 'ìˆœìš´ì „ìë³¸ë¹„ìœ¨(IFRS)',
            'ì°¨ì…ê¸ˆì˜ì¡´ë„(IFRSì—°ê²°)': 'ì°¨ì…ê¸ˆì˜ì¡´ë„(IFRS)',
            'ì°¨ì…ê¸ˆë¹„ìœ¨(IFRSì—°ê²°)': 'ì°¨ì…ê¸ˆë¹„ìœ¨(IFRS)',
            'ì´ìë³´ìƒë°°ìœ¨(ìˆœê¸ˆìœµë¹„ìš©)(IFRSì—°ê²°)': 'ì´ìë³´ìƒë°°ìœ¨(ìˆœê¸ˆìœµë¹„ìš©)(IFRS)',
            'ìœ ë³´ì•¡ëŒ€ë¹„ìœ¨(IFRSì—°ê²°)': 'ìœ ë³´ì•¡ëŒ€ë¹„ìœ¨(IFRS)',
            'ìœ ë³´ì•¡ ëŒ€ ë‚©ì…ìë³¸ë°°ìœ¨(IFRSì—°ê²°)': 'ìœ ë³´ì•¡ ëŒ€ ë‚©ì…ìë³¸ë°°ìœ¨(IFRS)',
            'ìœ ë™ìì‚°ì§‘ì¤‘ë„(IFRSì—°ê²°)': 'ìœ ë™ìì‚°ì§‘ì¤‘ë„(IFRS)',
            'ë¹„ìœ ë™ìì‚°ì§‘ì¤‘ë„(IFRSì—°ê²°)': 'ë¹„ìœ ë™ìì‚°ì§‘ì¤‘ë„(IFRS)',
            'íˆ¬ìì§‘ì¤‘ë„(IFRSì—°ê²°)': 'íˆ¬ìì§‘ì¤‘ë„(IFRS)',
            'CASH FLOW ëŒ€ ë¶€ì±„ë¹„ìœ¨(IFRSì—°ê²°)': 'CASH FLOW ëŒ€ ë¶€ì±„ë¹„ìœ¨(IFRS)',
            'CASH FLOW ëŒ€ ì°¨ì…ê¸ˆë¹„ìœ¨(IFRSì—°ê²°)': 'CASH FLOW ëŒ€ ì°¨ì…ê¸ˆë¹„ìœ¨(IFRS)',
            'CASH FLOW ëŒ€ ì´ìë³¸ë¹„ìœ¨(IFRSì—°ê²°)': 'CASH FLOW ëŒ€ ì´ìë³¸ë¹„ìœ¨(IFRS)',
            'CASH FLOW ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRSì—°ê²°)': 'CASH FLOW ëŒ€ ë§¤ì¶œì•¡ë¹„ìœ¨(IFRS)',
            'ì •ìƒì˜ì—…ì´ìµëŒ€ë¹„ì´ìë³´ìƒë°°ìœ¨(IFRSì—°ê²°)': 'ì •ìƒì˜ì—…ì´ìµëŒ€ë¹„ì´ìë³´ìƒë°°ìœ¨(IFRS)',
            
            # íšŒì „ìœ¨ ì§€í‘œë“¤
            'ê²½ì˜ìë³¸íšŒì „ë¥ (IFRSì—°ê²°)': 'ê²½ì˜ìë³¸íšŒì „ë¥ (IFRS)',
            'ìê¸°ìë³¸íšŒì „ë¥ (IFRSì—°ê²°)': 'ìê¸°ìë³¸íšŒì „ë¥ (IFRS)',
            'ìë³¸ê¸ˆíšŒì „ë¥ (IFRSì—°ê²°)': 'ìë³¸ê¸ˆíšŒì „ë¥ (IFRS)',
            'íƒ€ì¸ìë³¸íšŒì „ë¥ (IFRSì—°ê²°)': 'íƒ€ì¸ìë³¸íšŒì „ë¥ (IFRS)',
            'ë§¤ì…ì±„ë¬´íšŒì „ë¥ (IFRSì—°ê²°)': 'ë§¤ì…ì±„ë¬´íšŒì „ë¥ (IFRS)',
            'ë§¤ì…ì±„ë¬´íšŒì „ê¸°ê°„(IFRSì—°ê²°)': 'ë§¤ì…ì±„ë¬´íšŒì „ê¸°ê°„(IFRS)',
            'ìœ ë™ìì‚°íšŒì „ë¥ (IFRSì—°ê²°)': 'ìœ ë™ìì‚°íšŒì „ë¥ (IFRS)',
            'ë‹¹ì¢Œìì‚°íšŒì „ë¥ (IFRSì—°ê²°)': 'ë‹¹ì¢Œìì‚°íšŒì „ë¥ (IFRS)',
            'ì¬ê³ ìì‚°íšŒì „ë¥ (IFRSì—°ê²°)': 'ì¬ê³ ìì‚°íšŒì „ë¥ (IFRS)',
            'ì¬ê³ ìì‚°íšŒì „ê¸°ê°„(IFRSì—°ê²°)': 'ì¬ê³ ìì‚°íšŒì „ê¸°ê°„(IFRS)',
            'ìƒí’ˆ,ì œí’ˆíšŒì „ë¥ (IFRSì—°ê²°)': 'ìƒí’ˆ,ì œí’ˆíšŒì „ë¥ (IFRS)',
            'ì›,ë¶€ì¬ë£ŒíšŒì „ë¥ (IFRSì—°ê²°)': 'ì›,ë¶€ì¬ë£ŒíšŒì „ë¥ (IFRS)',
            'ì¬ê³µí’ˆíšŒì „ë¥ (IFRSì—°ê²°)': 'ì¬ê³µí’ˆíšŒì „ë¥ (IFRS)',
            'ë§¤ì¶œì±„ê¶ŒíšŒì „ë¥ (IFRSì—°ê²°)': 'ë§¤ì¶œì±„ê¶ŒíšŒì „ë¥ (IFRS)',
            'ë§¤ì¶œì±„ê¶ŒíšŒì „ê¸°ê°„(IFRSì—°ê²°)': 'ë§¤ì¶œì±„ê¶ŒíšŒì „ê¸°ê°„(IFRS)',
            'ë¹„ìœ ë™ìì‚°íšŒì „ë¥ (IFRSì—°ê²°)': 'ë¹„ìœ ë™ìì‚°íšŒì „ë¥ (IFRS)',
            'ìœ í˜•ìì‚°íšŒì „ìœ¨(IFRSì—°ê²°)': 'ìœ í˜•ìì‚°íšŒì „ìœ¨(IFRS)',
            'ìˆœìš´ì „ìë³¸íšŒì „ë¥ (IFRSì—°ê²°)': 'ìˆœìš´ì „ìë³¸íšŒì „ë¥ (IFRS)',
            'ìš´ì „ìë³¸íšŒì „ë¥ (IFRSì—°ê²°)': 'ìš´ì „ìë³¸íšŒì „ë¥ (IFRS)',
            '1íšŒì „ê¸°ê°„(IFRSì—°ê²°)': '1íšŒì „ê¸°ê°„(IFRS)',
            
            # ë¶€ê°€ê°€ì¹˜ ë° ìƒì‚°ì„± ì§€í‘œë“¤
            'ë¶€ê°€ê°€ì¹˜(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ë¶€ê°€ê°€ì¹˜(IFRS)(ë°±ë§Œì›)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ë¶€ê°€ê°€ì¹˜(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì¢…ì—…ì›1ì¸ë‹¹ ë¶€ê°€ê°€ì¹˜(IFRS)(ë°±ë§Œì›)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ë§¤ì¶œì•¡(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì¢…ì—…ì›1ì¸ë‹¹ ë§¤ì¶œì•¡(IFRS)(ë°±ë§Œì›)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ì •ìƒì˜ì—…ì´ìµ(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì¢…ì—…ì›1ì¸ë‹¹ ì •ìƒì˜ì—…ì´ìµ(IFRS)(ë°±ë§Œì›)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ìˆœì´ìµ(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì¢…ì—…ì›1ì¸ë‹¹ ìˆœì´ìµ(IFRS)(ë°±ë§Œì›)',
            'ì¢…ì—…ì›1ì¸ë‹¹ ì¸ê±´ë¹„(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì¢…ì—…ì›1ì¸ë‹¹ ì¸ê±´ë¹„(IFRS)(ë°±ë§Œì›)',
            'ë…¸ë™ì¥ë¹„ìœ¨(IFRSì—°ê²°)': 'ë…¸ë™ì¥ë¹„ìœ¨(IFRS)',
            'ê¸°ê³„ì¥ë¹„ìœ¨(IFRSì—°ê²°)': 'ê¸°ê³„ì¥ë¹„ìœ¨(IFRS)',
            'ìë³¸ì§‘ì•½ë„(IFRSì—°ê²°)': 'ìë³¸ì§‘ì•½ë„(IFRS)',
            'ì´ìë³¸íˆ¬ìíš¨ìœ¨(IFRSì—°ê²°)': 'ì´ìë³¸íˆ¬ìíš¨ìœ¨(IFRS)',
            'ì„¤ë¹„íˆ¬ìíš¨ìœ¨(IFRSì—°ê²°)': 'ì„¤ë¹„íˆ¬ìíš¨ìœ¨(IFRS)',
            'ê¸°ê³„íˆ¬ìíš¨ìœ¨(IFRSì—°ê²°)': 'ê¸°ê³„íˆ¬ìíš¨ìœ¨(IFRS)',
            'ë¶€ê°€ê°€ì¹˜ìœ¨(IFRSì—°ê²°)': 'ë¶€ê°€ê°€ì¹˜ìœ¨(IFRS)',
            'ë…¸ë™ì†Œë“ë¶„ë°°ìœ¨(IFRSì—°ê²°)': 'ë…¸ë™ì†Œë“ë¶„ë°°ìœ¨(IFRS)',
            'ìë³¸ë¶„ë°°ìœ¨(IFRSì—°ê²°)': 'ìë³¸ë¶„ë°°ìœ¨(IFRS)',
            'ì´ìœ¤ë¶„ë°°ìœ¨(IFRSì—°ê²°)': 'ì´ìœ¤ë¶„ë°°ìœ¨(IFRS)',
            
            # ì¶”ê°€ ì†ìµ ë° ë¹„ìš© ì§€í‘œë“¤
            'ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „(ê³„ì†ì‚¬ì—…)ì†ìµ(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „(ê³„ì†ì‚¬ì—…)ì†ìµ(IFRS)(ë°±ë§Œì›)',
            'ì¸ê±´ë¹„(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì¸ê±´ë¹„(IFRS)(ë°±ë§Œì›)',
            'ê¸ˆìœµë¹„ìš©(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ê¸ˆìœµë¹„ìš©(IFRS)(ë°±ë§Œì›)',
            'ì„ì°¨ë£Œ(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì„ì°¨ë£Œ(IFRS)(ë°±ë§Œì›)',
            'ì„¸ê¸ˆê³¼ê³µê³¼(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ì„¸ê¸ˆê³¼ê³µê³¼(IFRS)(ë°±ë§Œì›)',
            'ê°ê°€ìƒê°ë¹„(IFRSì—°ê²°)(ë°±ë§Œì›)': 'ê°ê°€ìƒê°ë¹„(IFRS)(ë°±ë§Œì›)',
            'ì¢…ì—…ì›ìˆ˜(IFRSì—°ê²°)': 'ì¢…ì—…ì›ìˆ˜(IFRS)',
            
            # ê°œë³„ì¬ë¬´ì œí‘œì—ë§Œ ìˆëŠ” ì»¬ëŸ¼ë“¤ (ë§¤ì¹­ ë¶ˆê°€)
            # 'ê¸°ì—…ê°€ì¹˜(EV)(IFRS)(ë°±ë§Œì›)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'EBITDA(IFRS)(ë°±ë§Œì›)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'EV/EBITDA(IFRS)(ë°°)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PER(ìµœê³ )(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PER(ìµœì €)(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PBR(ìµœê³ )(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PBR(ìµœì €)(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PCR(ìµœê³ )(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PCR(ìµœì €)(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PSR(ìµœê³ )(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'PSR(ìµœì €)(IFRS)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'EBITDA/ë§¤ì¶œì•¡(IFRS)(%)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'EBITDA/ê¸ˆìœµë¹„ìš©(IFRS)(ë°°)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
            # 'EBITDA/í‰ê· ë°œí–‰ì£¼ì‹ìˆ˜(IFRS)(ë°±ë§Œì›)': None,  # ì—°ê²°ì¬ë¬´ì œí‘œì— ì—†ìŒ
        }
        
        self.logger.info("FinancialDataMerger ì´ˆê¸°í™” ì™„ë£Œ")
    
    def _setup_logging(self) -> logging.Logger:
        """ë¡œê¹… ì„¤ì •"""
        logger = logging.getLogger('FinancialDataMerger')
        logger.setLevel(logging.INFO)
        
        # í•¸ë“¤ëŸ¬ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        for handler in logger.handlers[:]:
            logger.removeHandler(handler)
        
        # ì½˜ì†” í•¸ë“¤ëŸ¬
        console_handler = logging.StreamHandler()
        formatter = logging.Formatter('%(asctime)s - %(levelname)s - %(message)s')
        console_handler.setFormatter(formatter)
        logger.addHandler(console_handler)
        
        return logger
    
    def load_data(self) -> tuple[pd.DataFrame, pd.DataFrame]:
        """ë°ì´í„° ë¡œë“œ"""
        self.logger.info("ë°ì´í„° ë¡œë“œ ì‹œì‘")
        
        # ì²« ë²ˆì§¸ íŒŒì¼ (ë©”ì¸ ë°ì´í„°)
        primary_path = self.project_root / self.primary_file
        if not primary_path.exists():
            raise FileNotFoundError(f"ì²« ë²ˆì§¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {primary_path}")
        
        df1 = pd.read_csv(primary_path, dtype={'ê±°ë˜ì†Œì½”ë“œ': str})
        self.logger.info(f"ì²« ë²ˆì§¸ íŒŒì¼ ë¡œë“œ: {df1.shape}")
        
        # ë‘ ë²ˆì§¸ íŒŒì¼ (ë³´ì™„ ë°ì´í„°)
        secondary_path = self.project_root / self.secondary_file
        if not secondary_path.exists():
            raise FileNotFoundError(f"ë‘ ë²ˆì§¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {secondary_path}")
        
        df2 = pd.read_csv(secondary_path, dtype={'ê±°ë˜ì†Œì½”ë“œ': str})
        self.logger.info(f"ë‘ ë²ˆì§¸ íŒŒì¼ ë¡œë“œ: {df2.shape}")
        
        return df1, df2
    
    def filter_december_only(self, df: pd.DataFrame) -> pd.DataFrame:
        """12ì›” íšŒê³„ë…„ë„ë§Œ ìœ ì§€"""
        self.logger.info("íšŒê³„ë…„ë„ í•„í„°ë§ (12ì›”ë§Œ ìœ ì§€)")
        
        original_count = len(df)
        
        # íšŒê³„ë…„ë„ ì»¬ëŸ¼ì—ì„œ ì›” ì¶”ì¶œ
        if 'íšŒê³„ë…„ë„' in df.columns:
            # YYYY/mm í˜•íƒœì—ì„œ mm ì¶”ì¶œ
            df['month'] = df['íšŒê³„ë…„ë„'].astype(str).str.split('/').str[1]
            
            # 12ì›”ë§Œ ìœ ì§€
            df_filtered = df[df['month'] == '12'].copy()
            df_filtered = df_filtered.drop('month', axis=1)
            
            # íšŒê³„ë…„ë„ë¥¼ YYYY í˜•íƒœë¡œ ë³€í™˜
            df_filtered['íšŒê³„ë…„ë„'] = df_filtered['íšŒê³„ë…„ë„'].astype(str).str.split('/').str[0]
            
            filtered_count = len(df_filtered)
            removed_count = original_count - filtered_count
            
            self.logger.info(f"í•„í„°ë§ ì™„ë£Œ: {original_count:,}ê°œ â†’ {filtered_count:,}ê°œ ({removed_count:,}ê°œ ì œê±°)")
            
            return df_filtered
        else:
            self.logger.warning("íšŒê³„ë…„ë„ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return df
    
    
    def merge_and_fill_data(self, df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:
        """ë°ì´í„° ë³‘í•© ë° ê²°ì¸¡ì¹˜ ì±„ìš°ê¸° (ìˆ˜ë™ ë§¤í•‘ë§Œ ì‚¬ìš©)"""
        self.logger.info("ë°ì´í„° ë³‘í•© ë° ê²°ì¸¡ì¹˜ ì±„ìš°ê¸° ì‹œì‘")
        
        # í‚¤ ì»¬ëŸ¼ í™•ì¸
        key_cols = ['ê±°ë˜ì†Œì½”ë“œ', 'íšŒê³„ë…„ë„']
        for col in key_cols:
            if col not in df1.columns or col not in df2.columns:
                raise ValueError(f"í‚¤ ì»¬ëŸ¼ '{col}'ì´ ë‘ ë°ì´í„°í”„ë ˆì„ ì¤‘ í•˜ë‚˜ì— ì—†ìŠµë‹ˆë‹¤.")
        
        # ìˆ˜ë™ ë§¤í•‘ë§Œ ì‚¬ìš©
        final_mapping = self.column_mapping
        
        self.logger.info(f"ìˆ˜ë™ ì»¬ëŸ¼ ë§¤ì¹­: {len(final_mapping)}ê°œ")
        
        # ë§¤ì¹­ë˜ì§€ ì•Šì€ ì»¬ëŸ¼ë“¤ ì¶œë ¥
        unmatched_cols = []
        for col in df1.columns:
            if col not in key_cols and col not in final_mapping:
                unmatched_cols.append(col)
        
        if unmatched_cols:
            self.logger.warning(f"ë§¤ì¹­ë˜ì§€ ì•Šì€ ì»¬ëŸ¼ë“¤: {unmatched_cols}")
            self.logger.warning("í•„ìš”ì‹œ column_mapping ë”•ì…”ë„ˆë¦¬ì— ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•˜ì„¸ìš”.")
        
        # ê²°ê³¼ ë°ì´í„°í”„ë ˆì„ ì´ˆê¸°í™” (df1 ê¸°ë°˜)
        result_df = df1.copy()
        original_missing = result_df.isnull().sum().sum()
        
        # ë‘ ë²ˆì§¸ ë°ì´í„°í”„ë ˆì„ì—ë§Œ ìˆëŠ” ì»¬ëŸ¼ë“¤ ì¶”ê°€
        unique_cols_df2 = []
        for col in df2.columns:
            if col not in key_cols and col not in final_mapping.values():
                unique_cols_df2.append(col)
                result_df[col] = np.nan
        
        if unique_cols_df2:
            self.logger.info(f"ë‘ ë²ˆì§¸ íŒŒì¼ì˜ ê³ ìœ  ì»¬ëŸ¼ ì¶”ê°€: {unique_cols_df2}")
        
        # ë³‘í•©ì„ í†µí•œ ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°
        fill_count = 0
        total_rows = len(result_df)
        
        self.logger.info(f"ì´ {total_rows:,}ê°œ í–‰ ì²˜ë¦¬ ì‹œì‘...")
        
        for i, (idx, row) in enumerate(result_df.iterrows()):
            # ì§„í–‰ë¥  ì¶œë ¥ (1000ê°œ í–‰ë§ˆë‹¤)
            if (i + 1) % 1000 == 0 or i == 0:
                progress = (i + 1) / total_rows * 100
                self.logger.info(f"ì§„í–‰ë¥ : {i+1:,}/{total_rows:,} ({progress:.1f}%)")
            
            # ë§¤ì¹­ë˜ëŠ” í–‰ ì°¾ê¸°
            matching_rows = df2[
                (df2['ê±°ë˜ì†Œì½”ë“œ'] == row['ê±°ë˜ì†Œì½”ë“œ']) & 
                (df2['íšŒê³„ë…„ë„'] == row['íšŒê³„ë…„ë„'])
            ]
            
            if not matching_rows.empty:
                match_row = matching_rows.iloc[0]
                
                # ë§¤í•‘ëœ ì»¬ëŸ¼ë“¤ì˜ ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°
                for col1, col2 in final_mapping.items():
                    if col1 in result_df.columns and col2 in match_row.index:
                        if pd.isna(result_df.loc[idx, col1]) and not pd.isna(match_row[col2]):
                            result_df.loc[idx, col1] = match_row[col2]
                            fill_count += 1
                
                # ë‘ ë²ˆì§¸ íŒŒì¼ì˜ ê³ ìœ  ì»¬ëŸ¼ë“¤ ì±„ìš°ê¸°
                for col in unique_cols_df2:
                    if col in match_row.index and not pd.isna(match_row[col]):
                        result_df.loc[idx, col] = match_row[col]
                        fill_count += 1
        
        final_missing = result_df.isnull().sum().sum()
        filled_values = original_missing - final_missing
        
        self.logger.info(f"ê²°ì¸¡ì¹˜ ì±„ìš°ê¸° ì™„ë£Œ:")
        self.logger.info(f"  - ì›ë³¸ ê²°ì¸¡ì¹˜: {original_missing:,}ê°œ")
        self.logger.info(f"  - ì±„ì›Œì§„ ê°’: {filled_values:,}ê°œ")
        self.logger.info(f"  - ë‚¨ì€ ê²°ì¸¡ì¹˜: {final_missing:,}ê°œ")
        self.logger.info(f"  - ê°œì„ ìœ¨: {filled_values/original_missing*100:.1f}%" if original_missing > 0 else "  - ê°œì„ ìœ¨: 0%")
        
        return result_df
    
    def save_result(self, df: pd.DataFrame):
        """ê²°ê³¼ ì €ì¥"""
        output_dir = self.project_root / "data" / "processed"
        output_dir.mkdir(parents=True, exist_ok=True)
        
        output_path = output_dir / "FS_temp.csv"
        df.to_csv(output_path, index=False, encoding='utf-8-sig')
        
        self.logger.info(f"ê²°ê³¼ ì €ì¥ ì™„ë£Œ: {output_path}")
        self.logger.info(f"ìµœì¢… ë°ì´í„° í¬ê¸°: {df.shape}")
        
        return output_path
    
    def run_pipeline(self) -> str:
        """ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰"""
        self.logger.info("=== ì¬ë¬´ë°ì´í„° ë³‘í•© íŒŒì´í”„ë¼ì¸ ì‹œì‘ ===")
        
        try:
            # 1. ë°ì´í„° ë¡œë“œ
            df1, df2 = self.load_data()
            
            # 2. 12ì›” ë°ì´í„°ë§Œ í•„í„°ë§
            df1_filtered = self.filter_december_only(df1)
            df2_filtered = self.filter_december_only(df2)
            
            # 3. ë°ì´í„° ë³‘í•© ë° ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°
            result_df = self.merge_and_fill_data(df1_filtered, df2_filtered)
            
            # 4. ê²°ê³¼ ì €ì¥
            output_path = self.save_result(result_df)
            
            self.logger.info("=== ì¬ë¬´ë°ì´í„° ë³‘í•© íŒŒì´í”„ë¼ì¸ ì™„ë£Œ ===")
            
            return str(output_path)
            
        except Exception as e:
            self.logger.error(f"íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
            raise


def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    import argparse
    
    parser = argparse.ArgumentParser(description='ì¬ë¬´ë°ì´í„° ë³‘í•© ë° ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°')
    parser.add_argument(
        '--primary', '-p',
        type=str,
        default='data/raw/ì—°ê²°.csv',  # ì‹¤ì œ íŒŒì¼ëª…ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”
        help='ì²« ë²ˆì§¸ CSV íŒŒì¼ ê²½ë¡œ (ë©”ì¸ ë°ì´í„°)'
    )
    parser.add_argument(
        '--secondary', '-s',
        type=str,
        default='data/raw/ê°œë³„.csv',  # ì‹¤ì œ íŒŒì¼ëª…ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”
        help='ë‘ ë²ˆì§¸ CSV íŒŒì¼ ê²½ë¡œ (ë³´ì™„ ë°ì´í„°)'
    )
    
    args = parser.parse_args()
    
    # íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
    merger = FinancialDataMerger(args.primary, args.secondary)
    output_path = merger.run_pipeline()
    
    print(f"\nâœ… íŒŒì´í”„ë¼ì¸ ì™„ë£Œ!")
    print(f"ğŸ“ ê²°ê³¼ íŒŒì¼: {output_path}")
    
    # ì»¬ëŸ¼ ë§¤ì¹­ í™•ì¸ ë©”ì‹œì§€
    print(f"\nğŸ’¡ ì°¸ê³ ì‚¬í•­:")
    print(f"   - ì»¬ëŸ¼ ë§¤ì¹­ì´ ë¶€ì •í™•í•˜ë‹¤ë©´ ì½”ë“œ ë‚´ column_mapping ë”•ì…”ë„ˆë¦¬ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”")
    print(f"   - ë§¤ì¹­ë˜ì§€ ì•Šì€ ì»¬ëŸ¼ë“¤ì€ ë¡œê·¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤")


if __name__ == "__main__":
    main()